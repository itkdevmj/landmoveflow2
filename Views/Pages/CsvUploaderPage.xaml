<Page
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:dxdiag="http://schemas.devexpress.com/winfx/2008/xaml/diagram"
      xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
      xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
      xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
      xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
      xmlns:sys="clr-namespace:System;assembly=System.Runtime"
      x:Class="LMFS.Views.Pages.CsvUploaderPage"
      xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
      xmlns:xtraEditors="clr-namespace:DevExpress.XtraEditors;assembly=DevExpress.XtraEditors.v23.2"
      mc:Ignorable="d" 
      d:DesignHeight="350" d:DesignWidth="800"
      Title="[토지이동정리현황"
      Loaded="CsvUploaderPage_OnLoaded"
      SizeChanged="CsvUploaderPage_OnSizeChanged">

    <DockPanel>
        <Grid DockPanel.Dock="Left" Width="780">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="110"/>
            </Grid.RowDefinitions>

            <!-- Row 0 -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
                <Border BorderBrush="#A3C6C4" Background="#FF4C8DA0" BorderThickness="1" CornerRadius="5" Height="40">
                    <Grid Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="51*" />
                            <ColumnDefinition Width="13*"/>
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="0" Content="폴더 선택"  Command="{Binding OpenFolderCommand}" Width="120" Height="25" Margin="0,2,8,2" Grid.ColumnSpan="2" />
                        <TextBox Grid.Column="2" Name="FolderPathTextBox" Text="{Binding FolderPath, Mode=OneWay}" Width="640" Height="25" IsReadOnly="True" IsEnabled="False" Foreground="White" SelectionBrush="White" SelectionTextBrush="White" Margin="0,2,0,2" FontWeight="Bold" />
                    </Grid>
                </Border>
            </StackPanel>

            <!-- Row 1 -->
            <dxg:GridControl Grid.Row="1" Name="GridFileList"
                             AutoExpandAllGroups="True" AllowColumnMRUFilterList="False"
                                ItemsSource="{Binding GridFileList}" SelectionMode="Row"
                                dx:ScrollBarExtensions.ScrollBarMode="TouchOverlap" ShowBorder="True"
                                Margin="0" Cursor="Hand">
                <dxg:GridControl.View>
                    <dxg:TableView ShowIndicator="False" ShowGroupPanel="False" NavigationStyle="Row" AutoWidth="False">
                    </dxg:TableView>
                </dxg:GridControl.View>
                <dxg:GridControl.Columns>
                    <dxg:GridColumn FieldName="fileName" Header="파일목록" Width="1*" UnboundDataType="{x:Type sys:String}"
                                    ReadOnly="True" HorizontalHeaderContentAlignment="Center" />
                    <dxg:GridColumn FieldName="startDt" Header="시작일" Width="0.2*"
                                    ReadOnly="True" HorizontalHeaderContentAlignment="Center">
                        <dxg:GridColumn.EditSettings>
                            <dxe:DateEditSettings HorizontalContentAlignment="Center" />
                        </dxg:GridColumn.EditSettings>
                    </dxg:GridColumn>
                    <dxg:GridColumn FieldName="lastDt" Header="종료일" Width="0.2*" UnboundDataType="{x:Type sys:String}"
                                    ReadOnly="True" HorizontalHeaderContentAlignment="Center">
                            <dxg:GridColumn.EditSettings>
                                <dxe:DateEditSettings HorizontalContentAlignment="Center" />
                            </dxg:GridColumn.EditSettings>
                    </dxg:GridColumn>
                    <dxg:GridColumn FieldName="recordCnt" Header="레코드 건수" Width="0.2*" UnboundDataType="{x:Type sys:String}"
                                ReadOnly="True" HorizontalHeaderContentAlignment="Center">
                        <dxg:GridColumn.EditSettings>
                            <dxe:TextEditSettings DisplayFormat="N0" HorizontalContentAlignment="Right" />
                        </dxg:GridColumn.EditSettings>
                    </dxg:GridColumn>
                    <dxg:GridColumn FieldName="uploadCnt" Header="업로드 건수" Width="0.2*" UnboundDataType="{x:Type sys:String}"
                                ReadOnly="True" HorizontalHeaderContentAlignment="Center">
                        <dxg:GridColumn.EditSettings>
                            <dxe:TextEditSettings DisplayFormat="N0" HorizontalContentAlignment="Right" />
                        </dxg:GridColumn.EditSettings>
                    </dxg:GridColumn>
                </dxg:GridControl.Columns>
            </dxg:GridControl>

            <!-- Row 2 -->
            <Border Grid.Row="2" Grid.Column="0" BorderBrush="#A3C6C4" Background="#FFE0E7E9" BorderThickness="1" CornerRadius="5" Height="95">
                <Grid Margin="5">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <!-- Row 0 -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Left">
                        <!--<Button Content="DB 업로드" Command="{Binding UploadCommand}" IsEnabled="{Binding IsUploading, Converter={StaticResource InverseBoolConverter}}" Width="120" Height="25" HorizontalAlignment="Left" Margin="0,0,0,8" Background="#FFE65604" Foreground="White"/>-->
                        <!-- DB 업로드 버튼 - IsUploadReady True일 때만 표시 -->
                        <Button Content="DB 업로드" 
                                Command="{Binding UploadCommand}" 
                                IsEnabled="{Binding IsUploading, Converter={StaticResource InverseBoolConverter}}" 
                                Width="120" 
                                Height="25" 
                                HorizontalAlignment="Left" 
                                Margin="0,0,0,8" 
                                Background="#FFE65604" 
                                Foreground="White">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <!-- IsUploadReady가 True이고 IsCommitCompleted가 False일 때 표시 -->
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding IsUploadReady}" Value="True"/>
                                                <Condition Binding="{Binding IsCommitCompleted}" Value="False"/>
                                            </MultiDataTrigger.Conditions>
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </MultiDataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        <!-- TextBlock으로 알림 표시 -->
                        <TextBlock x:Name="txtUploadReady"
                                   Text="✓ 파일 로드 완료! 업로드 가능합니다."
                                   Height="25" 
                                   Foreground="#FFE65604"
                                   FontSize="14"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"
                                   Margin="10,0,0,0">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsUploadReady}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </StackPanel>
                    <!-- Row 1 -->
                    <StackPanel Grid.Row="1" Orientation="Horizontal"
                                Visibility="{Binding IsUploading, Converter={StaticResource BoolToVisibilityConverter}}" >                        
                        <TextBlock Text="{Binding ProgressText}" FontWeight="SemiBold" Width="120" Height="18" Margin="8,0,0,0" TextAlignment="Center" VerticalAlignment="Center"/>
                        <ProgressBar Value="{Binding ProgressValue}" Maximum="{Binding ProgressMax}" Width="600" Height="25"/>
                    </StackPanel>
                    <!-- Row 2 -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Left" Height="33" VerticalAlignment="Bottom">
                        <!-- 임시 텍스트로 상태 확인 -->
                        <TextBlock Text="{Binding IsUploadCompleted, StringFormat='Upload: {0}'}" Margin="5" Foreground="Red"/>
                        <!--<TextBlock Text="{Binding IsCommitCompleted, StringFormat='Commit: {0}'}" Margin="5" Foreground="Blue"/>-->
                        <!--<Button Content="DB 최종 적용" Command="{Binding CommitCommand}" IsEnabled="{Binding IsCommiting, Converter={StaticResource InverseBoolConverter}}" Width="120" Height="25" HorizontalAlignment="Left" Margin="0,0,0,8" Background="#FF66B821" Foreground="White"/>-->
                        <!-- DB 최종 적용 버튼 - 업로드 완료 후 표시, 적용 완료 후 숨김 -->
                        <Button Content="DB 최종 적용"
                            Visibility="{Binding ShowCommitButton, Converter={StaticResource BoolToVisibilityConverter}}"
                            Command="{Binding CommitCommand}" />
<!--                        <Button Content="DB 최종 적용" 
                                Command="{Binding CommitCommand}" 
                                IsEnabled="{Binding IsCommiting, Converter={StaticResource InverseBoolConverter}}" 
                                Width="120" 
                                Height="25" 
                                HorizontalAlignment="Left" 
                                Margin="0,0,0,8" 
                                Background="#FF66B821" 
                                Foreground="White">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>                                        
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding IsUploadCompleted}" Value="True"/>
                                                <Condition Binding="{Binding IsCommitCompleted}" Value="False"/>
                                            </MultiDataTrigger.Conditions>
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </MultiDataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
-->            
                    </StackPanel>     
                </Grid>
            </Border>
        </Grid>
    </DockPanel>

    <!-- [참고]텍스트 중앙 정렬
HorizontalContentAlignment="Center"
VerticalContentAlignment="Center"
Text="중앙 정렬 텍스트"
-->

</Page>
