<Page
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:dxdiag="http://schemas.devexpress.com/winfx/2008/xaml/diagram"
      xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
      xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
      xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
      xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
      xmlns:sys="clr-namespace:System;assembly=System.Runtime"
      xmlns:local="clr-namespace:LMFS.Engine"
      x:Class="LMFS.Views.Pages.LandMoveFlowPage"
      xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
      xmlns:xtraEditors="clr-namespace:DevExpress.XtraEditors;assembly=DevExpress.XtraEditors.v23.2"
      mc:Ignorable="d" 
      d:DesignHeight="600" d:DesignWidth="1000"
      Title="토지이동흐름도"
      Loaded="LandMoveFlowPage_OnLoaded"
      Unloaded="LandMoveFlowPage_Unloaded"
      SizeChanged="LandMoveFlowPage_OnSizeChanged">

    <Page.Resources>
        <local:ZoomPercentConverter x:Key="ZoomPercentConverter"/>
    </Page.Resources>

    <!--참고
    <Page.Resources>
        <Style x:Key="InfoCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="5"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>

        <Style x:Key="CardTitleStyle" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="맑은고딕 MDL2 Assets"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#333"/>
            <Setter Property="Margin" Value="0,0,0,5"/>
        </Style>

        <Style x:Key="CardContentStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="#555"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
        </Style>

        <Style x:Key="CardLabelStyle" TargetType="TextBlock" BasedOn="{StaticResource CardContentStyle}">
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
    </Page.Resources>
    -->

    <DockPanel>

        <Grid DockPanel.Dock="Left" Width="320">

            <Grid.RowDefinitions>
                <RowDefinition Height="130" />
                <RowDefinition Height="85" />
                <RowDefinition />
            </Grid.RowDefinitions>

            <Border Background="#A3C6C4" BorderThickness="2" CornerRadius="10" Padding="5">
                <StackPanel Grid.Row="0" Margin="5,5,5,5">
                    <dxlc:LayoutGroup Orientation="Horizontal" Height="28" Margin="4">
                        <dxe:ComboBoxEdit IsTextEditable="False" 
                                          ItemsSource="{Binding UmdList}"
                                          ValueMember="umdCd" DisplayMember="umdCdNm"
                                          SelectedItem="{Binding SelectedUmd, Mode=TwoWay}"/>
                        <dxe:ComboBoxEdit IsTextEditable="False"
                                          ItemsSource="{Binding RiList}"
                                          ValueMember="riCd" DisplayMember="riCdNm"
                                          SelectedItem="{Binding SelectedRi}"/>
                    </dxlc:LayoutGroup>
                    <dxlc:LayoutGroup Orientation="Horizontal" Height="28" Margin="4">
                        <Label Content="" Width="98" Margin="0" HorizontalContentAlignment="Center"/>
                        <CheckBox Content="산" Name="IsSan" Width="40"/>
                        <!-- 본번 -->
                        <dxe:TextEdit EditValue="{Binding Bobn, UpdateSourceTrigger=PropertyChanged}"
                                      Width="60" MaxLength="4" MaskType="Numeric" Mask="0000" MaskUseAsDisplayFormat="True"
                                      GotFocus="TextEdit_GotFocus"
                                      HorizontalContentAlignment="Center"
                                      VerticalContentAlignment="Center"
                                      Text="중앙 정렬 텍스트">
                            <dxe:TextEdit.InputBindings>
                                <KeyBinding Key="Enter" Command="{Binding EnterCommand}"></KeyBinding>
                            </dxe:TextEdit.InputBindings>
                        </dxe:TextEdit>
                        <Label Content="-" Width="15" Margin="0" HorizontalContentAlignment="Center"/>
                        <!-- 부번 -->
                        <dxe:TextEdit EditValue="{Binding Bubn, UpdateSourceTrigger=PropertyChanged}"
                                      Width="60" MaxLength="4" MaskType="Numeric" Mask="0000" MaskUseAsDisplayFormat="True"
                                      GotFocus="TextEdit_GotFocus"
                                      HorizontalContentAlignment="Center"
                                      VerticalContentAlignment="Center"
                                      Text="중앙 정렬 텍스트">
                            <dxe:TextEdit.InputBindings>
                                <KeyBinding Key="Enter" Command="{Binding EnterCommand}"></KeyBinding>
                            </dxe:TextEdit.InputBindings>
                        </dxe:TextEdit>
                    </dxlc:LayoutGroup>

                    <dxlc:LayoutGroup Orientation="Horizontal" HorizontalAlignment="Right" Height="28" Margin="4 4 4 2">
                        <Button Content="검색" Width="142" Command="{Binding SearchCommand}" FontWeight="Bold" Background="#FF3786BC" Foreground="White" BorderBrush="White"/>
                    </dxlc:LayoutGroup>
                </StackPanel>
            </Border>
            <StackPanel Grid.Row="1" Margin="5,5,5,5">
                <dxlc:LayoutGroup Orientation="Horizontal" HorizontalAlignment="Right" Height="28"
                                  Margin="10 5 10 5">
                    <Button Content="자료(CSV) 추가" Width="142" Command="{Binding LoadCsvFileDataCommand}" Foreground="White" BorderBrush="White" Background="#FFFF7F00" FontWeight="Bold"/>
                </dxlc:LayoutGroup>
                <Border Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3" BorderBrush="#A3C6C4" Background="#FFE0E7E9" BorderThickness="1" CornerRadius="5" Height="30" Margin="0 5 0 0">
                    <dxlc:LayoutGroup Orientation="Horizontal" HorizontalAlignment="Right" Height="28" Margin="0 5 0 5">
                        <CheckBox Content="[지목변경] 표시" IsChecked="{Binding JimokChg, Mode=TwoWay}" Height="28" Width="300" Background="White">
                        </CheckBox>
                    </dxlc:LayoutGroup>
                </Border>
            </StackPanel>

            <!--            <dxg:GridControl Grid.Row="2" Name="FlowDataGrid" AutoExpandAllGroups="True" AllowColumnMRUFilterList="False"
                                ItemsSource="{Binding GridDataSource}" SelectionMode="Row"
                                dx:ScrollBarExtensions.ScrollBarMode="TouchOverlap" ShowBorder="True"
                                Margin="4,0,4,4" Cursor="Hand">

                <dxmvvm:Interaction.Behaviors>
                    <dxmvvm:EventToCommand EventName="MouseDoubleClick" 
                                            Command="{Binding FlowDataDoubleClickCommand}"
                                            PassEventArgsToCommand="True"
                                            />
                </dxmvvm:Interaction.Behaviors>

                <dxg:GridControl.View>
                    <dxg:TableView ShowIndicator="False" ShowGroupPanel="False" NavigationStyle="Row" AutoWidth="False">
                    </dxg:TableView>
                </dxg:GridControl.View>
                <dxg:GridControl.Columns>
                    <dxg:GridColumn FieldName="bfPnu" Header="이동전" Width="1*" UnboundDataType="{x:Type sys:String}"
                                    ReadOnly="True" HorizontalHeaderContentAlignment="Center" />
                    <dxg:GridColumn FieldName="afPnu" Header="이동후" Width="1*" UnboundDataType="{x:Type sys:String}"
                                    ReadOnly="True" HorizontalHeaderContentAlignment="Center" />
                    <dxg:GridColumn FieldName="regDt" Header="정리일" Width="1*" HorizontalHeaderContentAlignment="Center"
                                    ReadOnly="True">
                        <dxg:GridColumn.EditSettings>
                            <dxe:DateEditSettings DisplayFormat="yyyyMMdd" ShowPopupIfReadOnly="False" HorizontalContentAlignment="Center" />
                        </dxg:GridColumn.EditSettings>
                    </dxg:GridColumn>
                    <dxg:GridColumn FieldName="rsn" Header="종목" Width="1.2*" MinWidth="120" HorizontalHeaderContentAlignment="Center" 
                                    ReadOnly="True">
                        <dxg:GridColumn.EditSettings>
                            <dxe:TextEditSettings HorizontalContentAlignment="Center" />
                        </dxg:GridColumn.EditSettings>
                    </dxg:GridColumn>
                </dxg:GridControl.Columns>                
            </dxg:GridControl>
-->


            <dxg:GridControl Grid.Row="2" Name="AnotherFlowDataGrid"
                             AutoExpandAllGroups="True" AllowColumnMRUFilterList="False"
                                ItemsSource="{Binding GridCategoryDataSource}"
                                SelectedItem="{Binding SelectedFlowData}" SelectionMode="Row"
                                dx:ScrollBarExtensions.ScrollBarMode="TouchOverlap" ShowBorder="True"
                                Margin="4,0,4,4" Cursor="Hand">

                <dxmvvm:Interaction.Behaviors>
                    <dxmvvm:EventToCommand EventName="MouseLeftButtonUp" 
                                            Command="{Binding RowClickCommand}"
                                            CommandParameter="{Binding Path=SelectedItem, ElementName=AnotherFlowDataGrid}"
                                            PassEventArgsToCommand="True"
                                            />
                </dxmvvm:Interaction.Behaviors>

                <dxg:GridControl.View>
                    <dxg:TableView ShowIndicator="False" ShowGroupPanel="False" NavigationStyle="Row" AutoWidth="False">
                    </dxg:TableView>
                </dxg:GridControl.View>
                <dxg:GridControl.Columns>
                    <dxg:GridColumn FieldName="regDt" Header="정리일" Width="1*" HorizontalHeaderContentAlignment="Center"
                                    ReadOnly="True">
                        <dxg:GridColumn.EditSettings>
                            <dxe:DateEditSettings DisplayFormat="yyyyMMdd" ShowPopupIfReadOnly="False" HorizontalContentAlignment="Center" />
                        </dxg:GridColumn.EditSettings>
                    </dxg:GridColumn>
                    <dxg:GridColumn FieldName="rsn" Header="종목" Width="1.2*" MinWidth="120" HorizontalHeaderContentAlignment="Center" 
                                    ReadOnly="True">
                        <dxg:GridColumn.EditSettings>
                            <dxe:TextEditSettings HorizontalContentAlignment="Center" />
                        </dxg:GridColumn.EditSettings>
                    </dxg:GridColumn>
                </dxg:GridControl.Columns>
                <!--<dxg:GridControl.TotalSummary>
                    <dxg:GridSummaryItem SummaryType="Count" Alignment="Right" />
                    <dxg:GridSummaryItem FieldName="FullName" SummaryType="Count" />
                </dxg:GridControl.TotalSummary>-->
            </dxg:GridControl>
            <!--- Hide : Unvisible(Collapsed) => Real DB Record -->
            <dxg:GridControl Grid.Row="2" Name="FlowDataGrid" Visibility="Collapsed" 
                             AutoExpandAllGroups="True" AllowColumnMRUFilterList="False"
                                ItemsSource="{Binding GridDataSource}" SelectionMode="Row"
                                dx:ScrollBarExtensions.ScrollBarMode="TouchOverlap" ShowBorder="True"
                                Margin="4,0,4,4" Cursor="Hand">

                <dxmvvm:Interaction.Behaviors>
                    <dxmvvm:EventToCommand EventName="MouseDoubleClick" 
                                            Command="{Binding FlowDataDoubleClickCommand}"
                                            PassEventArgsToCommand="True"
                                            />
                </dxmvvm:Interaction.Behaviors>

                <dxg:GridControl.View>
                    <dxg:TableView ShowIndicator="False" ShowGroupPanel="False" NavigationStyle="Row" AutoWidth="False">
                    </dxg:TableView>
                </dxg:GridControl.View>
                <dxg:GridControl.Columns>
                    <dxg:GridColumn FieldName="bfPnu" Header="이동전" Width="1*" UnboundDataType="{x:Type sys:String}"
                                    ReadOnly="True" HorizontalHeaderContentAlignment="Center" />
                    <dxg:GridColumn FieldName="afPnu" Header="이동후" Width="1*" UnboundDataType="{x:Type sys:String}"
                                    ReadOnly="True" HorizontalHeaderContentAlignment="Center" />
                    <dxg:GridColumn FieldName="regDt" Header="정리일" Width="1*" HorizontalHeaderContentAlignment="Center"
                                    ReadOnly="True">
                        <dxg:GridColumn.EditSettings>
                            <dxe:DateEditSettings DisplayFormat="yyyyMMdd" ShowPopupIfReadOnly="False" HorizontalContentAlignment="Center" />
                        </dxg:GridColumn.EditSettings>
                    </dxg:GridColumn>
                    <dxg:GridColumn FieldName="rsn" Header="종목" Width="1.2*" MinWidth="120" HorizontalHeaderContentAlignment="Center" 
                                    ReadOnly="True">
                        <dxg:GridColumn.EditSettings>
                            <dxe:TextEditSettings HorizontalContentAlignment="Center" />
                        </dxg:GridColumn.EditSettings>
                    </dxg:GridColumn>
                </dxg:GridControl.Columns>
                <!--<dxg:GridControl.TotalSummary>
                    <dxg:GridSummaryItem SummaryType="Count" Alignment="Right" />
                    <dxg:GridSummaryItem FieldName="FullName" SummaryType="Count" />
                </dxg:GridControl.TotalSummary>-->
            </dxg:GridControl>
        </Grid>

        <Border Background="WhiteSmoke" 
                BorderBrush="#A3C6C4"  BorderThickness="1" DockPanel.Dock="Top" Margin="0 0 0 0"
                CornerRadius="5">
            <!-- 5개의 원본 컬럼 정의 -->
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height = "50"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="190" />
                    <ColumnDefinition Width="*" />
                    <!-- Space -->
                    <ColumnDefinition Width="360" />
                </Grid.ColumnDefinitions>
                <Border Grid.Row="0" Grid.Column="0" BorderBrush="#A3C6C4" Background="#E0E7E9" BorderThickness="2" CornerRadius="5" Height="40" Margin="5 0 0 0">
                    <!-- 내부 Grid는 3컬럼을 하나로 감싸는 역할 -->
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height = "Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="80" />
                            <ColumnDefinition Width="50" />
                            <ColumnDefinition Width="50" />
                        </Grid.ColumnDefinitions>
                        <!--Mode=TwoWay 라는 건 화면에서 변경해도 ViewModel로 반영되고, ViewModel에서 변경해도 화면에 반영된다는 뜻-->
                        <CheckBox Grid.Column="0" IsChecked="{Binding IsOwnName, Mode=TwoWay}" Content="소유자명" Height="25" Margin="5 10 0 10"/>
                        <CheckBox Grid.Column="1" IsChecked="{Binding IsJimok, Mode=TwoWay}" Content="지목" Height="25" Margin="5 10 0 10" />
                        <CheckBox Grid.Column="2" IsChecked="{Binding IsArea, Mode=TwoWay}" Content="면적" Height="25" Margin="5 10 0 10" />
                    </Grid>
                </Border>
                <!-- Spacer: Grid.Column="1"는 나머지 영역을 차지해서 오른쪽으로 밀어줍니다 -->
                <Border Grid.Row="0" Grid.Column="2" BorderBrush="#A3C6C4" Background="#E0E7E9" BorderThickness="2" CornerRadius="5" Height="40" Margin="5 0 5 0">
                    <!-- 내부 Grid는 3컬럼을 하나로 감싸는 역할 -->
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height = "Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="0.8*" />
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="1.3*" />
                        </Grid.ColumnDefinitions>
                        <!--Mode=TwoWay 라는 건 화면에서 변경해도 ViewModel로 반영되고, ViewModel에서 변경해도 화면에 반영된다는 뜻-->
                        <CheckBox Grid.Column="0" IsChecked="{Binding Portrait, Mode=TwoWay}" Content="세로형" Foreground="#6C7A89" FontWeight="Bold" Height="25" Margin="5 10 0 10" />
                        <Grid Grid.Column="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <!-- TrackBarEdit -->
                            <!-- x:Name을 추가하면:XAML에서 ElementName 바인딩으로 참조 가능. 코드비하인드에서 this.ZoomTrackBar로 접근 가능-->
                            <dxe:TrackBarEdit 
                                    x:Name="ZoomTrackBar"   
                                    Grid.Column="0"
                                    Minimum="0.5" 
                                    Maximum="3" 
                                    TickFrequency="0.5" 
                                    Value="{Binding ElementName=LmfControl, Path=ZoomFactor, Mode=TwoWay}"
                                    Margin="10 10 10 10">
                            </dxe:TrackBarEdit>
                            <!-- 현재 배율 표시 라벨 -->
                            <TextBlock 
                                    Grid.Column="1"
                                    Text="{Binding ElementName=LmfControl, Path=ZoomFactor, Converter={StaticResource ZoomPercentConverter}}"
                                    VerticalAlignment="Center"
                                    FontWeight="Bold"
                                    FontSize="14"
                                    Margin="10 0 10 0"
                                    Foreground="#21808D"/>
                        </Grid>
                        <Button Grid.Column="2" Content="색상 설정" Width="100" Height="28" Command="{Binding SettingColorCommand}" Margin="0 0 0 10" BorderBrush="White" Background="#FF66B821" Foreground="White" FontWeight="Bold"/>
                    </Grid>
                </Border>
            </Grid>
            <!--<StackPanel Grid.Col="0" Margin="5,5,5,5">
                    <dxlc:LayoutGroup Orientation="Horizontal" Margin="10 5 0 0" Width="120"
                                      VerticalAlignment="Center" HorizontalAlignment="Left">
                        <CheckBox Content="소유자명 표시" Width="120"/>
                    </dxlc:LayoutGroup>
                </StackPanel>
            -->
        </Border>

        <Border Background="#A3C6C4" BorderThickness="1" CornerRadius="5" Padding="3">
            <dxdiag:DiagramControl ShowRulers="False" IsReadOnly="True" x:Name="LmfControl" 
                                   DocumentSource="{Binding LandMoveFlowData}" Opacity="1">
                <!--<dxmvvm:Interaction.Behaviors>
                    <dxdiag:DiagramDataBindingBehavior
                        ItemsSource="{Binding Path=Nodes}"
                        ConnectorsSource="{Binding Path=Connectors}"
                        KeyMember="Id"
                        ConnectorFromMember="Source"
                        ConnectorToMember="Target"
                        LayoutKind="Sugiyama" />
                </dxmvvm:Interaction.Behaviors>-->
            </dxdiag:DiagramControl>
        </Border>
    </DockPanel>

    <!-- [참고]텍스트 중앙 정렬
HorizontalContentAlignment="Center"
VerticalContentAlignment="Center"
Text="중앙 정렬 텍스트"
-->

</Page>
